name: Deploy to Windows Server

on:
  push:
    branches:
      - final-working

jobs:
  deploy:
    runs-on: [self-hosted]

    steps:

    - name: Generate SSH key pair
      run: |
        ssh-keygen -t ed25519 -N "" -f ssh_key
        echo "${{ secrets.SSH_PRIVATE_KEY }}" > ssh_key
      shell: bash

    - name: Store SSH private key
      uses: machine-learning-apps/store-secret-action@v2
      with:
        secret-name: SSH_PRIVATE_KEY
        secret-value: ${{ secrets.SSH_PRIVATE_KEY }}

    - name: Checkout code
      uses: actions/checkout@v2

    - name: Build project
      run: |
        expr 3 + 7 > ./math-homework.txt

    - name: Deploy to Windows Server
      uses: appleboy/scp-action@master
      with:
        host: 16.170.210.149
        username: Administrator
        key: 72sy!LuHfoRsVS=xhsl$.OWvBbEZTfrA
        port: 22
        source: ./math-homework.txt
        target: C:\
